---
apiVersion: v1
kind: ConfigMap
metadata:
  namespace: metallb-system
  name: bgpextras-node-0
data:
  extras: |
    router bgp 64999
      network 172.30.4.2/32
      neighbor 100.64.3.1 allowas-in origin
      neighbor 100.65.3.1 allowas-in origin

    ! ip prefix-list osp permit 172.16.0.0/16 le 32
    route-map 100.64.3.1-in permit 20
      ! match ip address prefix-list osp
      set src 172.30.4.2
    route-map 100.65.3.1-in permit 20
      ! match ip address prefix-list osp
      set src 172.30.4.2
    ip protocol bgp route-map 100.64.3.1-in
    ip protocol bgp route-map 100.65.3.1-in

    ip prefix-list ocp-lo permit 172.30.4.2/32
    route-map 100.64.3.1-out permit 3
      match ip address prefix-list ocp-lo
    route-map 100.65.3.1-out permit 3
      match ip address prefix-list ocp-lo
  nodeSelectors:
  - matchExpressions:
    - key: kubernetes.io/hostname
      operator: In
      values: ["master-0"]
---
apiVersion: v1
kind: ConfigMap
metadata:
  namespace: metallb-system
  name: bgpextras-node-1
data:
  extras: |
    router bgp 64999
      network 172.30.4.3/32
      neighbor 100.64.3.5 allowas-in origin
      neighbor 100.65.3.5 allowas-in origin

    ! ip prefix-list osp permit 172.16.0.0/16 le 32
    route-map 100.64.3.5-in permit 20
      ! match ip address prefix-list osp
      set src 172.30.4.3
    route-map 100.65.3.5-in permit 20
      ! match ip address prefix-list osp
      set src 172.30.4.3
    ip protocol bgp route-map 100.64.3.5-in
    ip protocol bgp route-map 100.65.3.5-in

    ip prefix-list ocp-lo permit 172.30.4.3/32
    route-map 100.64.3.5-out permit 3
      match ip address prefix-list ocp-lo
    route-map 100.65.3.5-out permit 3
      match ip address prefix-list ocp-lo
  nodeSelectors:
  - matchExpressions:
    - key: kubernetes.io/hostname
      operator: In
      values: ["master-1"]
---
apiVersion: v1
kind: ConfigMap
metadata:
  namespace: metallb-system
  name: bgpextras-node-2
data:
  extras: |
    router bgp 64999
      network 172.30.4.4/32
      neighbor 100.64.3.9 allowas-in origin
      neighbor 100.65.3.9 allowas-in origin

    ! ip prefix-list osp permit 172.16.0.0/16 le 32
    route-map 100.64.3.9-in permit 20
      ! match ip address prefix-list osp
      set src 172.30.4.4
    route-map 100.65.3.9-in permit 20
      ! match ip address prefix-list osp
      set src 172.30.4.4
    ip protocol bgp route-map 100.64.3.9-in
    ip protocol bgp route-map 100.65.3.9-in

    ip prefix-list ocp-lo permit 172.30.4.4/32
    route-map 100.64.3.9-out permit 3
      match ip address prefix-list ocp-lo
    route-map 100.65.3.9-out permit 3
      match ip address prefix-list ocp-lo
  nodeSelectors:
  - matchExpressions:
    - key: kubernetes.io/hostname
      operator: In
      values: ["master-2"]
